<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lyl.mapper.CommodityMapper">

    <resultMap id="CommodityResultMap" type="com.lyl.entity.Commodity">
        <id property="commodityId" column="commodity_id"></id>
        <result property="commodityName" column="commodity_name"></result>
        <result property="commodityDetails" column="commodity_Details"></result>
        <result property="commodityPrice" column="commodity_price"></result>
        <collection property="imagePath" ofType="string">
            <constructor>
                <arg column="image_path"/>
            </constructor>
        </collection>
    </resultMap>


    <resultMap id="EvaluationResultMap" type="com.lyl.entity.Evaluation">
        <id property="evaluationId" column="evaluation_id"></id>
        <result property="evaluationContent" column="evaluation_content"></result>
        <result property="evaluationBelongUser" column="evaluation_belong_user"></result>
        <result property="evaluationDate" column="evaluation_date"></result>
        <result property="evaluationBelongCommodity_id" column="evaluation_belong_commodity_id"></result>
        <collection property="evaluationImagePath" ofType="string">
            <constructor>
                <arg column="image_path"/>
            </constructor>
        </collection>
    </resultMap>

    <select id="selectCommodityInfoById" resultMap="CommodityResultMap" parameterType="integer">
        select c.*,i.image_path
        from commodity_info as c
        left join
        image as i
        on
        c.commodity_id=i.image_belong_commodity_id
        where i.image_belong_user='admin' and c.commodity_id=#{commodityId};
    </select>

    <select id="selectEvaluationByCommodityId" resultMap="EvaluationResultMap" resultType="list" parameterType="integer">
        select e.evaluation_belong_user,e.evaluation_content,e.evaluation_date,e.evaluation_id,e.evaluation_belong_commodity_id,i.image_path
        from evaluation as e
        left join
        (select * from image as oi where oi.image_belong_commodity_id=#{commodityId}) as i
        on
        e.evaluation_belong_user=i.image_belong_user
        where e.evaluation_belong_commodity_id=#{commodityId};
    </select>

    <select id="selectCommodityInfoAll" resultMap="CommodityResultMap" resultType="list">
        select
        c.*,i.image_path
        from commodity_info as c
        left join image as i
        on
        c.commodity_id=i.image_belong_commodity_id
        where i.image_belong_user='admin';
    </select>

<!--    <insert id="saveOrder" parameterType="com.lyl.entity.Order">-->
<!--        insert into-->
<!--            OrderInfo(order_id, user_name, order_subject, order_body, order_statu, order_pay_mode)-->
<!--        values(-->
<!--            #{orderInfo.orderId},#{orderInfo.userName},#{orderInfo.orderSubject},#{orderInfo.orderBody},#{orderInfo.orderStatu},#{orderInfo.orderPayMode}-->
<!--        );-->
<!--    </insert>-->

<!--    <update id="updateOrderByOrderId" parameterType="string">-->
<!--        update OrderInfo set  order_statu=#{status} where order_id=#{orderId}-->
<!--    </update>-->

<!--    <select id="selectOrderByUserName" resultMap="orderResultMap" resultType="list">-->
<!--        select * from OrderInfo;-->
<!--    </select>-->

<!--    <delete id="deleteOrderByOrderId" parameterType="string">-->
<!--        delete from OrderInfo where order_id=#{orderId}-->
<!--    </delete>-->

</mapper>